<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页-有票</title>
    <link rel="stylesheet" href="../css/commonHeader.css">
    <link rel="stylesheet" href="../css/front-page-havingTicket.css">
    <script src="../../../../config/config.js"></script>
    <script src="../js/common.js"></script>
    <script src="../../../../jQuery/jquery-3.5.1.js"></script>
</head>

<body>
    <header>
        <div class="image">
            <img src="../image/2.png" alt="">
        </div>
        <div class="welcome">
            <div class="icon"></div>
            <div class="greet">
                <span>您好,李先生</span>
            </div>
        </div>
    </header>
    <nav>
        <div class="icon position-icon"></div>
        <div class="icon drop"></div>
        <div class="position">
            <span>成都</span>
        </div>
    </nav>

    <div class="title">
        <h4>待使用电影票</h4>
    </div>
    <div class="usingTicket">
        <div class="tickets">
            <div class="item">
                <h4>哥斯拉大战金刚</h4>
                <p>
                    成都双楠电影城·2020-04-16&nbsp;19:00
                </p>
                <div class="line">
                    <img src="../image/线.png" alt="">
                </div>
                <div class="ticketInfo">
                    <div class="min-item">
                        <span>515334</span>
                    </div>
                    <div class="min-item">
                        <a href="">查看详情&nbsp;&gt</a>
                    </div>
                </div>
            </div>
            <div class="item">
                <h4>指环王:护戒行者</h4>
                <p>
                    成都双楠电影城·2020-04-16&nbsp;19:00
                </p>
                <div class="line">
                    <img src="../image/线.png" alt="">
                </div>
                <div class="ticketInfo">
                    <div class="min-item">
                        <span>515334</span>
                    </div>
                    <div class="min-item">
                        <a href="">查看详情&nbsp;&gt</a>
                    </div>
                </div>
            </div>
            <div class="item">
                <h4>八月未央</h4>
                <p>
                    成都双楠电影城·2020-04-16&nbsp;19:00
                </p>
                <div class="line">
                    <img src="../image/线.png" alt="">
                </div>
                <div class="ticketInfo">
                    <div class="min-item">
                        <span>515334</span>
                    </div>
                    <div class="min-item">
                        <a href="">查看详情&nbsp;&gt</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="title">
        <div class="item">
            <div class="min-item">
                <h6>正在热映</h6>
            </div>
            <div class="min-item">
                <a href="">查看更多</a>
            </div>
        </div>
    </div>

    <div class="container isShowing">
        <div class="movieList" style="font-size: 0.2rem;"></div>
    </div>

    <div class="title">
        <div class="item">
            <div class="min-item">
                <h6>即将上映</h6>
            </div>
            <div class="min-item">
                <a href="">查看更多</a>
            </div>
        </div>
    </div>

    <div class="container willShow">
        <div class="movieList" style="font-size: 0.2rem;"></div>
    </div>

    <footer>
        <div class="menu">
            <div class="item">
                <div class="icon front-page"></div>
                <div class="menuName menuName-frontPage">
                    <a href="../html/front-page-havingTicket.html">
                        <span>首页</span>
                    </a>
                </div>
            </div>
            <div class="item">
                <div class="icon cinema"></div>
                <div class="menuName menuName-cinema">
                    <a href="../html/cinema.html">
                        <span>影院</span>
                    </a>
                </div>
            </div>
            <div class="item">
                <div class="icon film"></div>
                <div class="menuName menuName-film">
                    <a href="../html/myTikect.html">
                        <span>影片</span>
                    </a>
                </div>
            </div>
            <div class="item">
                <div class="icon mine"></div>
                <div class="menuName menuName-mine">
                    <a href="../html/mine.html">
                        <span>我的</span>
                    </a>
                </div>
            </div>
    </footer>
</body>

</html>
<script>
    // 正在热映
    let movieList = getMovies()
    let cinema = getCinema()
    let moviesId = []

    // 获取正在上映的电影ID
    async function getMoviesId() {
        await cinema.then((data) => {
            if (data.operas.length) {
                data.operas.forEach(item => {
                    if (item.movies.length) {
                        item.movies.forEach(id => {
                            if (moviesId.indexOf(id) === -1) {
                                moviesId.push(id)
                            }
                        })
                    }
                })
            }
        })
        return moviesId
    }

    // 正在上映
    getMoviesId().then((data) => {
        if (data.length) {
            let isShowingMovie = []
            movieList.then(movieData => {
                if (movieData.movies.length) {
                    movieData.movies.forEach(data => {
                        if (moviesId.indexOf(data.id) !== -1) {
                            isShowingMovie.push(data)
                        }
                    })
                }
                let div = isShowingMovie.map(item => {
                    let movieName = item.title.split(" ")[0]
                    let image = item.imgSrc
                    return `
                            <div class="list">
                                <div class="picture">
                                    <img src="${image}" alt="">
                                </div>
                                <div class="movieName">
                                    <span>${movieName}</span>
                                </div>
                            </div>
                `
                }).join("")
                $(".isShowing .movieList").append(div)
            })
        } else {
            $(".isShow .movieList").html("暂无数据")
        }
    })

    // 即将上映
    getMoviesId().then(data => {
        let willShowMovies = []
        if (data.length) {
            movieList.then(movieData => {
                if (movieData.movies.length) {
                    movieData.movies.forEach(data => {
                        if (moviesId.indexOf(data.id) === -1) {
                            willShowMovies.push(data)
                        }
                    })
                }
                let div = willShowMovies.map(willShowMoviesData => {
                    let movieName = willShowMoviesData.title.split(" ")[0]
                    let image = willShowMoviesData.imgSrc
                    return `
                            <div class="list">
                                <div class="picture">
                                    <img src="${image}" alt="">
                                </div>
                                <div class="movieName">
                                    <span>${movieName}</span>
                                </div>
                            </div>
                    `
                }).join("")
                $(".willShow .movieList").append(div)
            })
        }
    })
</script>