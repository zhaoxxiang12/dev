<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改密码</title>
    <script src="../../../../config/config.js"></script>
    <link rel="stylesheet" href="../css/updatePaaword.css">
    <script src="../../../../jQuery/jquery-3.5.1.js"></script>
    <script src="../../../../jQuery/mock.js"></script>
</head>
<body>
    <!--    头部 -->
    <header>
        <div class="image">
            <img src="../image/2.png" alt="">
        </div>
        <div class="arrow"></div>
        <div class="login">
            <span>修改密码</span>
        </div>
    </header>
    <!-- 内容 -->
    <main>
        <form action="" id="form">
            <span>旧密码</span>
            <p>
                <input type="password" id="userName">
                <br>
                <span style="color: red; margin: 0; display: none; margin-top: 12px;" class="username-warnning"></span>
            </p>
            <span>密码</span>
            <p>
                <input type="password" id="password">
                <br>
                <span style="color: red; margin: 0; display: none; margin-top: 12px;" class="password-warnning"></span>
            </p>
                <span>确认密码</span>
            <p>
                <input type="password" id="rePassword">  
                <br>
                <span style="color: red; margin: 0; display: none; margin-top: 12px;" class="repassword-warnning"></span>
            </p>
            <div class="icon"></div>
            <div class="icon-oldPassword"></div>
            <div class="icon-rePassword"></div>
            <div class="regist">
            <p>
                <button type="button" id="submit">
                    <a href="javascript:">确认修改</a>
                </button>
            </p>
            </div>

        </form>
    </main>
</body>
</html>
<script>
    let userId = location.search.split('=')[1]
    let users = localStorage.getItem("users")
    users = JSON.parse(users)
    let result = users.filter(item => item.id == userId)
    $("#submit").click(function () {
        let username = $('#userName').val().trim()
        let password = $('#password').val().trim()
        let rePassword = $("#rePassword").val().trim()
        if (username.length == 0) {
            $('.username-warnning').css("display", 'block').html("旧密码不能为空")
            return
        }
        if (password.length == 0) {
            $('.password-warnning').css("display", 'block').html("密码不能为空")
            return
        }
        if (rePassword.length == 0) {
            $('.repassword-warnning').css("display", 'block').html("确认密码不能为空")
            return
        }

        if (password !== rePassword) {
            $('.password-warnning').css("display", 'block').html("两次输入的密码不一致")
            return
        }

        if (username == password) {
            $('.password-warnning').css("display", 'block').html("新密码不能和旧密码一致")
            return    
        }

        if (username !== result[0].password) {
            $('.username-warnning').css("display", 'block').html("旧密码输入错误")
            return    
        }

        $.ajax({
            url:'update',
            dataType:"json",
            data:json,
            contentType:"application/json",
            success (msg) {
                if (msg.status) {
                    alert(msg.message)
                    location.href = "../html/login"
                }
            }
        })
        // result[0].password = password
        // users.forEach (item => {
        //     if (item.id == result[0].id) {
        //        item = result 
        //     }
        // }) 
        // users = JSON.stringify(users)
        // localStorage.setItem("users", users) 
    })




    $('#form').on("input propertyChange", '#userName', function () {
        $('.username-warnning').css("display", 'none')
    })

    $('#form').on("input propertyChange", '#password', function () {
        $('.password-warnning').css("display", 'none')
    })

    $('#form').on("input propertyChange", '#rePassword', function () {
        $('.repassword-warnning').css("display", 'none')
    })

    Mock.mock('update', 'put', function (req) {
        return {
            message:"修改成功",
            status: 1
        }
    })
</script>